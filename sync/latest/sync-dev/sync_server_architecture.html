<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>aerogear Latest | Sync User Guide | Server architecture</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="Red Hat" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://aerogear.org/"><img alt="Build Farm" src="../../latest/_images/aerogear_logo_200px.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">AeroGear</a>
      </li>
      <li class="hidden-xs active">
        <a href="../sync-dev/sync_overview.html">aerogear Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../sync-dev/sync_overview.html">Sync User Guide</a>
      </li>
      
      <li class="hidden-xs active">
        Server architecture
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Sync User Guide
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../sync-dev/sync_overview.html">Overview</a></li>
            <li><a class="" href="../sync-dev/sync_terminology.html">Terminology</a></li>
            <li><a class=" active" href="../sync-dev/sync_server_architecture.html">Server architecture</a></li>
            <li><a class="" href="../sync-dev/sync_configuration_guide.html">Configuration guide</a></li>
            <li><a class="" href="../sync-dev/sync_upgrade_guide.html">Upgrade guide</a></li>
            <li><a class="" href="../sync-dev/sync_performance_scaling_guide.html">Performance guide</a></li>
            <li><a class="" href="../sync-dev/sync_collections.html">Collections</a></li>
            <li><a class="" href="../sync-dev/sync_debugging_guide.html">Debugging guide</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Sync API Guide
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../sync-ref/sync.html">sync</a></li>
            <li><a class="" href="../sync-ref/sync-connect.html">connect</a></li>
            <li><a class="" href="../sync-ref/sync-geteventemitter.html">geteventemitter</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlecollision.html">globalhandlecollision</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlecreate.html">globalhandlecreate</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandledelete.html">globalhandledelete</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlelist.html">globalhandlelist</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandleread.html">globalhandleread</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandleupdate.html">globalhandleupdate</a></li>
            <li><a class="" href="../sync-ref/sync-globalinterceptrequest.html">globalinterceptrequest</a></li>
            <li><a class="" href="../sync-ref/sync-globallistcollisions.html">globallistcollisions</a></li>
            <li><a class="" href="../sync-ref/sync-globalremovecollision.html">globalremovecollision</a></li>
            <li><a class="" href="../sync-ref/sync-handlecollision.html">handlecollision</a></li>
            <li><a class="" href="../sync-ref/sync-handlecreate.html">handlecreate</a></li>
            <li><a class="" href="../sync-ref/sync-handledelete.html">handledelete</a></li>
            <li><a class="" href="../sync-ref/sync-handlelist.html">handlelist</a></li>
            <li><a class="" href="../sync-ref/sync-handleread.html">handleread</a></li>
            <li><a class="" href="../sync-ref/sync-handleupdate.html">handleupdate</a></li>
            <li><a class="" href="../sync-ref/sync-init.html">init</a></li>
            <li><a class="" href="../sync-ref/sync-interceptrequest.html">interceptrequest</a></li>
            <li><a class="" href="../sync-ref/sync-invoke.html">invoke</a></li>
            <li><a class="" href="../sync-ref/sync-listcollisions.html">listcollisions</a></li>
            <li><a class="" href="../sync-ref/sync-removecollision.html">removecollision</a></li>
            <li><a class="" href="../sync-ref/sync-setconfig.html">setconfig</a></li>
            <li><a class="" href="../sync-ref/sync-setglobalhashfn.html">setglobalhashfn</a></li>
            <li><a class="" href="../sync-ref/sync-setrecordhashfn.html">setrecordhashfn</a></li>
            <li><a class="" href="../sync-ref/sync-stop.html">stop</a></li>
            <li><a class="" href="../sync-ref/sync-stopall.html">stopall</a></li>
            <li><a class="" href="../sync-ref/sync-toc.html">toc</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Sync Server Architecture</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>For a general overview of the Sync Framework, see <a href="#data-sync-framework">Sync Overview</a> and <a href="#sync-terminology">Sync Terminology</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Sync Server architecture includes:
* HTTP handlers
* Queues and processors
* The sync scheduler</p>
</div>
<div class="paragraph">
<p>Each of these components persist data in MongoDB.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Sync Server Architecture">
</div>
</div>
<div class="sect2">
<h3 id="http-handlers"><a class="anchor" href="#http-handlers"></a>HTTP Handlers</h3>
<div class="paragraph">
<p>These handlers are responsible for handling the Sync requests from Sync Clients.</p>
</div>
<div class="sect3">
<h4 id="sync-http-handler"><a class="anchor" href="#sync-http-handler"></a>Sync HTTP Handler</h4>
<div class="paragraph">
<p>Creates or updates the Dataset Client and pushes pending records
and acknowledgements on to the appropriate queues for processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="sync-records-http-handler"><a class="anchor" href="#sync-records-http-handler"></a>Sync Records HTTP Handler</h4>
<div class="paragraph">
<p>Compares up-to-date data with a client&#8217;s state. After getting the delta, it checks for updates that are processed, but not yet synced.
This handler iterates through all the records in the delta. If any records are in the pending queue or have been applied, this handler removes them from the delta and returns the updated delta to the client.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queues"><a class="anchor" href="#queues"></a>Queues</h3>
<div class="paragraph">
<p>The following queues are used in the Sync Framework:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fhsync_queue</code> - jobs for datasets that require synchronization.</p>
</li>
<li>
<p><code>fhsync_ack_queue</code> - jobs for pending changes that require acknowledgement.</p>
</li>
<li>
<p><code>fhsync_pending_queue</code> - jobs for pending changes that require processing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Messages are placed on these queues and are consumed by processors.</p>
</div>
</div>
<div class="sect2">
<h3 id="processors"><a class="anchor" href="#processors"></a>Processors</h3>
<div class="paragraph">
<p>Each queue has a corresponding processor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync Processor - takes jobs from <code>fhsync_queue</code> and processes those jobs.</p>
</li>
<li>
<p>Ack Processor - takes acknowledgements from <code>fhsync_ack_queue</code> and removes those acknowledgements from MongoDB.</p>
</li>
<li>
<p>Pending Processor - takes pending items from <code>fhsync_pending_queue</code> and applies the changes to the Dataset Backend.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each worker in a Sync Server has one instance of each of these processors allowing the tasks to be distributed.</p>
</div>
</div>
<div class="sect2">
<h3 id="sync-scheduler"><a class="anchor" href="#sync-scheduler"></a>Sync Scheduler</h3>
<div class="paragraph">
<p>When horizontally scaled, each Sync Worker attempts to become the Sync Scheduler at fixed intervals. Each worker tries to obtain a lock which is located in MongoDB. The worker that has the Sync Scheduler lock determines which Datasets need to be synchronized  by looking at the timestamp of the last synchronization and the sync frequency for the Dataset. If a Dataset needs to be synchronized, a job is added to <code>fhsync_queue</code>.</p>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>