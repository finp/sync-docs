<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>aerogear Latest | Sync User Guide | Collections</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="Red Hat" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="https://aerogear.org/"><img alt="Build Farm" src="../../latest/_images/aerogear_logo_200px.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">AeroGear</a>
      </li>
      <li class="hidden-xs active">
        <a href="../sync-dev/sync_overview.html">aerogear Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../sync-dev/sync_overview.html">Sync User Guide</a>
      </li>
      
      <li class="hidden-xs active">
        Collections
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-down"></span>Sync User Guide
      </a>
      <ul id="topicGroup0" class="collapse in list-unstyled">
            <li><a class="" href="../sync-dev/sync_overview.html">Overview</a></li>
            <li><a class="" href="../sync-dev/sync_terminology.html">Terminology</a></li>
            <li><a class="" href="../sync-dev/sync_server_architecture.html">Server architecture</a></li>
            <li><a class="" href="../sync-dev/sync_configuration_guide.html">Configuration guide</a></li>
            <li><a class="" href="../sync-dev/sync_upgrade_guide.html">Upgrade guide</a></li>
            <li><a class="" href="../sync-dev/sync_performance_scaling_guide.html">Performance guide</a></li>
            <li><a class=" active" href="../sync-dev/sync_collections.html">Collections</a></li>
            <li><a class="" href="../sync-dev/sync_debugging_guide.html">Debugging guide</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Sync API Guide
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../sync-ref/sync.html">sync</a></li>
            <li><a class="" href="../sync-ref/sync-connect.html">connect</a></li>
            <li><a class="" href="../sync-ref/sync-geteventemitter.html">geteventemitter</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlecollision.html">globalhandlecollision</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlecreate.html">globalhandlecreate</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandledelete.html">globalhandledelete</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandlelist.html">globalhandlelist</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandleread.html">globalhandleread</a></li>
            <li><a class="" href="../sync-ref/sync-globalhandleupdate.html">globalhandleupdate</a></li>
            <li><a class="" href="../sync-ref/sync-globalinterceptrequest.html">globalinterceptrequest</a></li>
            <li><a class="" href="../sync-ref/sync-globallistcollisions.html">globallistcollisions</a></li>
            <li><a class="" href="../sync-ref/sync-globalremovecollision.html">globalremovecollision</a></li>
            <li><a class="" href="../sync-ref/sync-handlecollision.html">handlecollision</a></li>
            <li><a class="" href="../sync-ref/sync-handlecreate.html">handlecreate</a></li>
            <li><a class="" href="../sync-ref/sync-handledelete.html">handledelete</a></li>
            <li><a class="" href="../sync-ref/sync-handlelist.html">handlelist</a></li>
            <li><a class="" href="../sync-ref/sync-handleread.html">handleread</a></li>
            <li><a class="" href="../sync-ref/sync-handleupdate.html">handleupdate</a></li>
            <li><a class="" href="../sync-ref/sync-init.html">init</a></li>
            <li><a class="" href="../sync-ref/sync-interceptrequest.html">interceptrequest</a></li>
            <li><a class="" href="../sync-ref/sync-invoke.html">invoke</a></li>
            <li><a class="" href="../sync-ref/sync-listcollisions.html">listcollisions</a></li>
            <li><a class="" href="../sync-ref/sync-removecollision.html">removecollision</a></li>
            <li><a class="" href="../sync-ref/sync-setconfig.html">setconfig</a></li>
            <li><a class="" href="../sync-ref/sync-setglobalhashfn.html">setglobalhashfn</a></li>
            <li><a class="" href="../sync-ref/sync-setrecordhashfn.html">setrecordhashfn</a></li>
            <li><a class="" href="../sync-ref/sync-stop.html">stop</a></li>
            <li><a class="" href="../sync-ref/sync-stopall.html">stopall</a></li>
            <li><a class="" href="../sync-ref/sync-toc.html">toc</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>MongoDB Collections Created by the Sync Server</h2>
        </div>
        <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sync server will maintain various collections in MongoDB while it&#8217;s running.</p>
</div>
<div class="paragraph">
<p>This document will explain what collections the sync server will create and their purpose.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should not modify these collections, as it may cause data loss.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sync-server-collections"><a class="anchor" href="#sync-server-collections"></a>Sync Server Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All the collections created by the sync server will have the prefix <strong>fhsync</strong>.</p>
</div>
<div class="sect2">
<h3 id="strong-fhsync_pending_queue-strong"><a class="anchor" href="#strong-fhsync_pending_queue-strong"></a><strong>fhsync_pending_queue</strong></h3>
<div class="paragraph">
<p>This collection is used to save the changes submitted from all the clients for all the Datasets.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tries</strong>: If the value is greater than 0, it means the change has been processed already by the sync server.</p>
</li>
<li>
<p><strong>payload.hash</strong>: The unique identifier of the pending change.</p>
</li>
<li>
<p><strong>payload.cuid</strong>: The unique id of the client.</p>
</li>
<li>
<p><strong>payload.action</strong>: The type of the change, like <code>create</code> or <code>update</code>.</p>
</li>
<li>
<p><strong>payload.pre</strong>: The data before the change was made.</p>
</li>
<li>
<p><strong>payload.post</strong>: The data after the change was made.</p>
</li>
<li>
<p><strong>payload.timestamp</strong>: When the change was made on the client.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_-datasetid-_updates-strong"><a class="anchor" href="#strong-fhsync_-datasetid-_updates-strong"></a><strong>fhsync_&lt;datasetId&gt;_updates</strong></h3>
<div class="paragraph">
<p>When a pending change from the <code>fhsync_pending_queue</code> collection is processed, the result is saved in this collection.
The client will get the result when they next sync, any trigger any relevant client notifications.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>hash</strong>: The unique identifier of the pending change from the above collection.</p>
</li>
<li>
<p><strong>type</strong>: If the change is applied successfully. Possible values are <code>applied</code>, <code>failed</code> or <code>collision</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_ack_queue-strong"><a class="anchor" href="#strong-fhsync_ack_queue-strong"></a><strong>fhsync_ack_queue</strong></h3>
<div class="paragraph">
<p>After a client gets the results of its submitted changes (as saved in the <code>fhsync_&lt;datasetId&gt;_updates</code> collection), it will confirm the acknowledgements with the server so that server can remove them.
This collection is used to save the acknowledgements submitted by the clients.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>payload.hash</strong>: The unique identifier of a pending change from the <strong>fhsync_pending_queue</strong> collection.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_datasetclients-strong"><a class="anchor" href="#strong-fhsync_datasetclients-strong"></a><strong>fhsync_datasetClients</strong></h3>
<div class="paragraph">
<p>This collection is used to persist all the Dataset clients that are managed by the sync server.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>globalHash</strong>: The current hash value of the Dataset Client.</p>
</li>
<li>
<p><strong>queryParam</strong>: The query parameters associated with the Dataset Client.</p>
</li>
<li>
<p><strong>metaData</strong>: The meta data associated with the Dataset Client.</p>
</li>
<li>
<p><strong>recordUids</strong>: The unique ids of all the records that belong to the Dataset Client.</p>
</li>
<li>
<p><strong>syncLoopEnd</strong>: When the last sync loop finished for the Dataset Client.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_-datasetid-_records-strong"><a class="anchor" href="#strong-fhsync_-datasetid-_records-strong"></a><strong>fhsync_&lt;datasetId&gt;_records</strong></h3>
<div class="paragraph">
<p>This data in this collection is a local copy of the data from the Dataset Backend.
It will help to speed up the sync requests from the clients, and also reduce the number of requests to the Dataset Backend.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>data</strong>: The actual data of the record returned from the Dataset Backend.</p>
</li>
<li>
<p><strong>uid</strong>: The unique id of the record.</p>
</li>
<li>
<p><strong>refs</strong>: The ids of all the Dataset Clients that contain this record.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_queue-strong"><a class="anchor" href="#strong-fhsync_queue-strong"></a><strong>fhsync_queue</strong></h3>
<div class="paragraph">
<p>This collection is used to save the requests to sync <strong>fhsync_&lt;datasetId&gt;_records</strong> with the Dataset Backend.</p>
</div>
<div class="paragraph">
<p>Some of the useful fields for debugging are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>tries</strong>: If it&#8217;s greater than 0, it means the request is already processed by the sync server.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-fhsync_locks-strong"><a class="anchor" href="#strong-fhsync_locks-strong"></a><strong>fhsync_locks</strong></h3>
<div class="paragraph">
<p>Only 1 worker is allowed to sync with the Dataset Backend at any given time.
To ensure that, a lock is used.
This collection is used to persist the lock.
It is unlikely you&#8217;ll ever need to look at this collection, unless debugging an issue with the locking mechanism.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pruning-the-queue-collections"><a class="anchor" href="#pruning-the-queue-collections"></a>Pruning the Queue Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each of the queue collections, a document is not removed immediately after being processed.
Instead, it is marked as <code>deleted</code>.
This will allow developers to use them as an audit log, and also help with debugging.</p>
</div>
<div class="paragraph">
<p>To prevent these queues from using too much space, you can set a TTL (time to live) value for those messages. Once the TTL value is reached, these messages will be deleted from the database.</p>
</div>
<div class="paragraph">
<p>For more information, see the "queueMessagesTTL" option in <a href="{CloudAPI}#fh-set-config">$fh.sync.setConfig</a>.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>